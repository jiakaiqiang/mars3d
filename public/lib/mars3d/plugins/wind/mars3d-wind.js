/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.5.15
 * 编译日期：2023-07-11 17:33:08
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x294171=_0x57c7;(function(_0x5e3212,_0xd55bca){const _0x27d767=_0x57c7,_0x4fae7b=_0x5e3212();while(!![]){try{const _0x5b9cef=-parseInt(_0x27d767(0x23b))/0x1*(-parseInt(_0x27d767(0x258))/0x2)+parseInt(_0x27d767(0x1ed))/0x3*(parseInt(_0x27d767(0x1c0))/0x4)+parseInt(_0x27d767(0x24b))/0x5+parseInt(_0x27d767(0x1b4))/0x6*(parseInt(_0x27d767(0x207))/0x7)+-parseInt(_0x27d767(0x1c4))/0x8+-parseInt(_0x27d767(0x201))/0x9+-parseInt(_0x27d767(0x225))/0xa*(-parseInt(_0x27d767(0x1d6))/0xb);if(_0x5b9cef===_0xd55bca)break;else _0x4fae7b['push'](_0x4fae7b['shift']());}catch(_0x5ac8df){_0x4fae7b['push'](_0x4fae7b['shift']());}}}(_0x452d,0xbfc49));function _0x452d(){const _0x431588=['rgb(206,255,255)','defined','min','windField','colorTable','removeAll','register','all','mouseDown','OPAQUE','applyViewerParameters','now','26754CjGjDV','show','RGBA','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','mouseMove','WindUtil','none','particlesNumber','lng','lon','fixedHeight','clientWidth','3992wOSuMl','PixelDatatype','uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','Compute','12072928YdxRtZ','_tomap','_setOptionsHook','canvasWidth','lineWidth','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','particlesRendering','vdata','canvasWind','setDate','bindEvent','_calc_speedRate','nextParticlesPosition','stroke','destroy','_speedRate','zIndex','_calcUV','11wpZiPF','nextTrailsDepth','createRenderingTextures','clientHeight','tlng','NEAREST','CanvasWindField','_mountedHook','animateFrame','add','pointerEvents','lev','visibility','currentParticlesPosition','_onMouseUpEvent','floor','getPixelSize','style','_maxAge','clear','off','viewerParameters','_updateIng2','303tjsWfw','Draw','forEach','primitives','_updateIng','colors','getFullscreenQuad','canvasResize','beginPath','data','frameTime','wheel','Cesium','commandToExecute','height','geometry','windTextures','ymin','toDegrees','container','416727avOjCT','Matrix4','pow','getUVByXY','depthTest','speedRate','665YChvNf','createTexture','particlesTextures','GeometryAttribute','autoClear','latRange','mode','VertexArray','textures','fromCache','BaseLayer','fragmentShaderSource','Cartesian3','keys','0px','drawingBufferWidth','WindLayer','clearFramebuffers','currentTrails','layer','shaderProgram','destroyParticlesTextures','maxParticles','vertexArray','BoundingSphere','mouse_move','STATIC_DRAW','dimensions','mouseHidden','THREE_PI_OVER_TWO','6328290LaEAGt','create','PrimitiveCollection','segments','createCommand','visible','atan2','preRender','framebuffers','mouse_down','EventType','getParticles','canvasHeight','Cartesian2','segmentsDepth','canvas','resize','windData','_pointerEvents','_onMouseMoveEvent','currentParticlesSpeed','unbindEvent','569888YkfMGQ','abs','primitiveType','createRawRenderState','removeChild','getOptions','Sampler','particlesComputing','destination-in','fromGeometry','execute','preExecute','fromCssColorString','update','getColorTexture','_drawLines','3068900UUnvwf','sqrt','dropRateBump','age','ShaderSource','lat','setData','postProcessingSpeed','_createCanvas','options','__esModule','speedFactor','globeBoundingSphere','2cDSUOp','worker','initWorker','south','PixelFormat','_data','PI_OVER_THREE','depthTexture','createParticlesTextures','FLOAT','drawingBufferHeight','camera','cols','outputTexture','UNSIGNED_INT','_randomParticle','SCENE3D','lighter','width','xmax','udata','nextTrails','nextParticlesSpeed','createFramebuffer','createRenderingFramebuffers','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','_map','PrimitiveType','TRIANGLES','particleSystem','clearCommand','attributeLocations','grid','scene','vertexShaderSource','_onMouseDownEvent','canvasContext','pixelSize','color','tlat','left','max','postProcessingPosition','default','defineProperty','context','_onMapWhellEvent','redraw','ZERO','Math','segmentsColor','toGridXY','Pass','_showHook','Geometry','ymax','xmin','push','moveTo','createSegmentsGeometry','_addedHook','BufferUsage','fadeOpacity','positionWC','rows'];_0x452d=function(){return _0x431588;};return _0x452d();}function _interopNamespace(_0x21234d){const _0x3bd66e=_0x57c7;if(_0x21234d&&_0x21234d[_0x3bd66e(0x255)])return _0x21234d;var _0x2ca038=Object[_0x3bd66e(0x226)](null);return _0x21234d&&Object[_0x3bd66e(0x214)](_0x21234d)[_0x3bd66e(0x1ef)](function(_0x1e13df){const _0x50aa61=_0x3bd66e;if(_0x1e13df!==_0x50aa61(0x192)){var _0x4d4462=Object['getOwnPropertyDescriptor'](_0x21234d,_0x1e13df);Object[_0x50aa61(0x193)](_0x2ca038,_0x1e13df,_0x4d4462['get']?_0x4d4462:{'enumerable':!![],'get':function(){return _0x21234d[_0x1e13df];}});}}),_0x2ca038[_0x3bd66e(0x192)]=_0x21234d,_0x2ca038;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0xbc5cf3,_0x269f15){const _0xe1f5d6=_0xbc5cf3*Math['cos'](Cesium$7['Math']['toRadians'](_0x269f15));return _0xe1f5d6;}function getV(_0x4f293c,_0x454a5b){const _0x3a2df3=_0x57c7,_0x1a12b2=_0x4f293c*Math['sin'](Cesium$7[_0x3a2df3(0x198)]['toRadians'](_0x454a5b));return _0x1a12b2;}function getSpeed(_0x41140a,_0x2f82d5){const _0x11180c=_0x57c7,_0x46c767=Math['sqrt'](Math[_0x11180c(0x203)](_0x41140a,0x2)+Math['pow'](_0x2f82d5,0x2));return _0x46c767;}function _0x57c7(_0x394d6e,_0x5bfaae){const _0x452db9=_0x452d();return _0x57c7=function(_0x57c7e5,_0x27edb7){_0x57c7e5=_0x57c7e5-0x18d;let _0x4ca94f=_0x452db9[_0x57c7e5];return _0x4ca94f;},_0x57c7(_0x394d6e,_0x5bfaae);}function getDirection(_0x50539e,_0x44f5f9){const _0xba4ad0=_0x57c7;let _0x47c48c=Cesium$7['Math'][_0xba4ad0(0x1ff)](Math[_0xba4ad0(0x22b)](_0x44f5f9,_0x50539e));return _0x47c48c+=_0x47c48c<0x0?0x168:0x0,_0x47c48c;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x28655e){const _0x54bc3e=_0x57c7;this['commandType']=_0x28655e['commandType'],this['geometry']=_0x28655e['geometry'],this[_0x54bc3e(0x277)]=_0x28655e['attributeLocations'],this['primitiveType']=_0x28655e[_0x54bc3e(0x23d)],this['uniformMap']=_0x28655e['uniformMap'],this['vertexShaderSource']=_0x28655e[_0x54bc3e(0x27a)],this[_0x54bc3e(0x212)]=_0x28655e[_0x54bc3e(0x212)],this['rawRenderState']=_0x28655e['rawRenderState'],this['framebuffer']=_0x28655e['framebuffer'],this['outputTexture']=_0x28655e[_0x54bc3e(0x265)],this[_0x54bc3e(0x20b)]=_0x28655e['autoClear']??![],this[_0x54bc3e(0x246)]=_0x28655e['preExecute'],this[_0x54bc3e(0x1b5)]=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this[_0x54bc3e(0x20b)]&&(this[_0x54bc3e(0x276)]=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x54bc3e(0x19b)]['OPAQUE']}));}[_0x294171(0x229)](_0x2e32db){const _0x29a43b=_0x294171;switch(this['commandType']){case _0x29a43b(0x1ee):{const _0x2ab3fb=Cesium$6['VertexArray']['fromGeometry']({'context':_0x2e32db,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage'][_0x29a43b(0x221)]}),_0x49a146=Cesium$6['ShaderProgram'][_0x29a43b(0x210)]({'context':_0x2e32db,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x3c5659=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x49a146,'vertexArray':_0x2ab3fb,'modelMatrix':Cesium$6[_0x29a43b(0x202)]['IDENTITY'],'renderState':_0x3c5659,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x29a43b(0x19b)][_0x29a43b(0x1b1)],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this[_0x29a43b(0x265)],'persists':!![]});}}}['setGeometry'](_0x829978,_0x4c8272){const _0xe1542f=_0x294171;this['geometry']=_0x4c8272;const _0x429769=Cesium$6['VertexArray'][_0xe1542f(0x244)]({'context':_0x829978,'geometry':this['geometry'],'attributeLocations':this[_0xe1542f(0x277)],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x429769;}['update'](_0x5b26d7){const _0xf085fa=_0x294171;if(!this['show'])return;if(_0x5b26d7['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x5b26d7['context'])),Cesium$6[_0xf085fa(0x1a9)](this['preExecute'])&&this[_0xf085fa(0x246)](),Cesium$6[_0xf085fa(0x1a9)](this['clearCommand'])&&_0x5b26d7['commandList']['push'](this[_0xf085fa(0x276)]),_0x5b26d7['commandList']['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x302852=_0x294171;if(this['clearCommand']){var _0x1f0b6e,_0x326d86;(_0x1f0b6e=this['clearCommand'])!==null&&_0x1f0b6e!==void 0x0&&_0x1f0b6e['vertexArray']&&this['clearCommand'][_0x302852(0x21e)]['destroy'](),(_0x326d86=this['clearCommand'])!==null&&_0x326d86!==void 0x0&&_0x326d86[_0x302852(0x21b)]&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this[_0x302852(0x1fa)]&&(this[_0x302852(0x1fa)]['vertexArray']&&this[_0x302852(0x1fa)]['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this[_0x302852(0x1fa)]['shaderProgram'][_0x302852(0x1d2)](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace[_0x294171(0x1f9)],Util=(function(){const _0x236eae=function(){const _0x22337e=_0x57c7,_0x346837=new Cesium$5[(_0x22337e(0x19d))]({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5[(_0x22337e(0x20a))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x346837;},_0x7b24fc=function(_0x5e0b1b,_0x29cea0){if(Cesium$5['defined'](_0x29cea0)){const _0x4192db={};_0x4192db['arrayBufferView']=_0x29cea0,_0x5e0b1b['source']=_0x4192db;}const _0x2045c9=new Cesium$5['Texture'](_0x5e0b1b);return _0x2045c9;},_0x517cd5=function(_0x5eef4e,_0x47588a,_0x31c274){const _0x4e887e=new Cesium$5['Framebuffer']({'context':_0x5eef4e,'colorTextures':[_0x47588a],'depthTexture':_0x31c274});return _0x4e887e;},_0x446161=function(_0x2b8001){const _0x425e90=_0x57c7,_0x33b477=!![],_0x4a9e7e=![],_0x56f47f={'viewport':_0x2b8001['viewport'],'depthTest':_0x2b8001[_0x425e90(0x205)],'depthMask':_0x2b8001['depthMask'],'blending':_0x2b8001['blending']},_0x595141=Cesium$5['Appearance']['getDefaultRenderState'](_0x33b477,_0x4a9e7e,_0x56f47f);return _0x595141;},_0x43b643=function(_0x16dbb6){const _0x29cbc3=_0x57c7,_0x2f99f1={},_0x15a3eb=Cesium$5['Math']['mod'](_0x16dbb6['west'],Cesium$5[_0x29cbc3(0x198)]['TWO_PI']),_0x520767=Cesium$5[_0x29cbc3(0x198)]['mod'](_0x16dbb6['east'],Cesium$5[_0x29cbc3(0x198)]['TWO_PI']),_0x3d4da2=_0x16dbb6[_0x29cbc3(0x26a)];let _0x23ee8f,_0x544412;_0x3d4da2>Cesium$5['Math'][_0x29cbc3(0x224)]?(_0x23ee8f=0x0,_0x544412=Cesium$5['Math']['TWO_PI']):_0x520767-_0x15a3eb<_0x3d4da2?(_0x23ee8f=_0x15a3eb,_0x544412=_0x15a3eb+_0x3d4da2):(_0x23ee8f=_0x15a3eb,_0x544412=_0x520767);_0x2f99f1[_0x29cbc3(0x1bd)]={'min':Cesium$5['Math'][_0x29cbc3(0x1ff)](_0x23ee8f),'max':Cesium$5['Math']['toDegrees'](_0x544412)};const _0x3d395e=_0x16dbb6[_0x29cbc3(0x25b)],_0x317472=_0x16dbb6['north'],_0x149a68=_0x16dbb6['height'],_0xe24024=_0x149a68>Cesium$5['Math']['PI']/0xc?_0x149a68/0x2:0x0;let _0x4d9f70=Cesium$5[_0x29cbc3(0x198)]['clampToLatitudeRange'](_0x3d395e-_0xe24024),_0x35fe72=Cesium$5['Math']['clampToLatitudeRange'](_0x317472+_0xe24024);return _0x4d9f70<-Cesium$5['Math'][_0x29cbc3(0x25e)]&&(_0x4d9f70=-Cesium$5['Math']['PI_OVER_TWO']),_0x35fe72>Cesium$5[_0x29cbc3(0x198)]['PI_OVER_THREE']&&(_0x35fe72=Cesium$5['Math']['PI_OVER_TWO']),_0x2f99f1['lat']={'min':Cesium$5[_0x29cbc3(0x198)][_0x29cbc3(0x1ff)](_0x4d9f70),'max':Cesium$5['Math'][_0x29cbc3(0x1ff)](_0x35fe72)},_0x2f99f1;};return{'getFullscreenQuad':_0x236eae,'createTexture':_0x7b24fc,'createFramebuffer':_0x517cd5,'createRawRenderState':_0x446161,'viewRectangleToLonLatRange':_0x43b643};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace[_0x294171(0x1f9)];class ParticlesRendering{constructor(_0x2c95a8,_0x96c102,_0x2a2549,_0x1f6830,_0x599d57){const _0xdccf7a=_0x294171;this[_0xdccf7a(0x1d8)](_0x2c95a8,_0x96c102,_0x2a2549['colors']),this[_0xdccf7a(0x270)](_0x2c95a8),this['createRenderingPrimitives'](_0x2c95a8,_0x2a2549,_0x1f6830,_0x599d57);}[_0x294171(0x1d8)](_0x224791,_0x1ffa04,_0x3fedfd){const _0x30163f=_0x294171,_0x4da9be={'context':_0x224791,'width':_0x224791['drawingBufferWidth'],'height':_0x224791['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat'][_0x30163f(0x1b6)],'pixelDatatype':Cesium$4[_0x30163f(0x1c1)]['UNSIGNED_BYTE']},_0x5b8d58={'context':_0x224791,'width':_0x224791[_0x30163f(0x216)],'height':_0x224791[_0x30163f(0x262)],'pixelFormat':Cesium$4[_0x30163f(0x25c)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4[_0x30163f(0x1c1)][_0x30163f(0x266)]},_0x1c46ac=_0x3fedfd['length'],_0xf73258=new Float32Array(_0x1c46ac*0x3);for(let _0x2c297d=0x0;_0x2c297d<_0x1c46ac;_0x2c297d++){const _0x171b43=Cesium$4['Color'][_0x30163f(0x247)](_0x3fedfd[_0x2c297d]);_0xf73258[0x3*_0x2c297d]=_0x171b43['red'],_0xf73258[0x3*_0x2c297d+0x1]=_0x171b43['green'],_0xf73258[0x3*_0x2c297d+0x2]=_0x171b43['blue'];}const _0x4566de={'context':_0x224791,'width':_0x1c46ac,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x30163f(0x261)],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x4da9be),'segmentsDepth':Util['createTexture'](_0x5b8d58),'currentTrailsColor':Util['createTexture'](_0x4da9be),'currentTrailsDepth':Util['createTexture'](_0x5b8d58),'nextTrailsColor':Util['createTexture'](_0x4da9be),'nextTrailsDepth':Util['createTexture'](_0x5b8d58),'colorTable':Util[_0x30163f(0x208)](_0x4566de,_0xf73258)};}['createRenderingFramebuffers'](_0x2dd523){const _0x63aacb=_0x294171;this['framebuffers']={'segments':Util['createFramebuffer'](_0x2dd523,this['textures'][_0x63aacb(0x199)],this[_0x63aacb(0x20f)][_0x63aacb(0x233)]),'currentTrails':Util['createFramebuffer'](_0x2dd523,this[_0x63aacb(0x20f)]['currentTrailsColor'],this[_0x63aacb(0x20f)]['currentTrailsDepth']),'nextTrails':Util[_0x63aacb(0x26f)](_0x2dd523,this['textures']['nextTrailsColor'],this[_0x63aacb(0x20f)][_0x63aacb(0x1d7)])};}['createSegmentsGeometry'](_0xd1ed6a){const _0x598bd0=_0x294171,_0x14dbaa=0x4;let _0x4fcd87=[];for(let _0x3b30b6=0x0;_0x3b30b6<_0xd1ed6a['particlesTextureSize'];_0x3b30b6++){for(let _0x26be1d=0x0;_0x26be1d<_0xd1ed6a['particlesTextureSize'];_0x26be1d++){for(let _0x116db8=0x0;_0x116db8<_0x14dbaa;_0x116db8++){_0x4fcd87['push'](_0x3b30b6/_0xd1ed6a['particlesTextureSize']),_0x4fcd87[_0x598bd0(0x1a0)](_0x26be1d/_0xd1ed6a['particlesTextureSize']);}}}_0x4fcd87=new Float32Array(_0x4fcd87);let _0x5cbf04=[];const _0x267cad=[-0x1,0x1],_0x3c32a6=[-0x1,0x1];for(let _0x3a6196=0x0;_0x3a6196<_0xd1ed6a['maxParticles'];_0x3a6196++){for(let _0x235c55=0x0;_0x235c55<_0x14dbaa/0x2;_0x235c55++){for(let _0x1b7c71=0x0;_0x1b7c71<_0x14dbaa/0x2;_0x1b7c71++){_0x5cbf04['push'](_0x267cad[_0x235c55]),_0x5cbf04[_0x598bd0(0x1a0)](_0x3c32a6[_0x1b7c71]),_0x5cbf04[_0x598bd0(0x1a0)](0x0);}}}_0x5cbf04=new Float32Array(_0x5cbf04);const _0x4385f0=0x6*_0xd1ed6a['maxParticles'],_0x400779=new Uint32Array(_0x4385f0);for(let _0x3f1358=0x0,_0x145cb5=0x0,_0x2285b2=0x0;_0x3f1358<_0xd1ed6a['maxParticles'];_0x3f1358++){_0x400779[_0x145cb5++]=_0x2285b2+0x0,_0x400779[_0x145cb5++]=_0x2285b2+0x1,_0x400779[_0x145cb5++]=_0x2285b2+0x2,_0x400779[_0x145cb5++]=_0x2285b2+0x2,_0x400779[_0x145cb5++]=_0x2285b2+0x1,_0x400779[_0x145cb5++]=_0x2285b2+0x3,_0x2285b2+=0x4;}const _0x479696=new Cesium$4[(_0x598bd0(0x19d))]({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x598bd0(0x261)],'componentsPerAttribute':0x2,'values':_0x4fcd87}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x5cbf04})}),'indices':_0x400779});return _0x479696;}['createRenderingPrimitives'](_0x1ef205,_0x94d6,_0x3b0ccc,_0x105d2d){const _0x49ef09=_0x294171,_0x5f0e0a=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x94d6),'primitiveType':Cesium$4['PrimitiveType'][_0x49ef09(0x274)],'uniformMap':{'currentParticlesPosition':function(){const _0x4afa81=_0x49ef09;return _0x105d2d['particlesTextures'][_0x4afa81(0x1e3)];},'postProcessingPosition':function(){const _0x39c821=_0x49ef09;return _0x105d2d[_0x39c821(0x209)][_0x39c821(0x191)];},'postProcessingSpeed':function(){const _0x2de852=_0x49ef09;return _0x105d2d[_0x2de852(0x209)]['postProcessingSpeed'];},'colorTable':function(){return _0x5f0e0a['textures']['colorTable'];},'aspect':function(){return _0x1ef205['drawingBufferWidth']/_0x1ef205['drawingBufferHeight'];},'pixelSize':function(){const _0x39158b=_0x49ef09;return _0x3b0ccc[_0x39158b(0x27d)];},'lineWidth':function(){return _0x94d6['lineWidth'];},'particleHeight':function(){return _0x94d6['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this[_0x49ef09(0x22d)][_0x49ef09(0x228)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x49ef09(0x1f3)](),'primitiveType':Cesium$4[_0x49ef09(0x273)][_0x49ef09(0x274)],'uniformMap':{'segmentsColorTexture':function(){return _0x5f0e0a['textures']['segmentsColor'];},'segmentsDepthTexture':function(){return _0x5f0e0a['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x2d4cce=_0x49ef09;return _0x5f0e0a[_0x2d4cce(0x22d)]['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x5e8d15=_0x49ef09;return _0x5f0e0a['framebuffers']['currentTrails'][_0x5e8d15(0x25f)];},'fadeOpacity':function(){const _0x4daf24=_0x49ef09;return _0x94d6[_0x4daf24(0x1a5)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x49ef09(0x24f))]({'defines':[_0x49ef09(0x271)],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x49ef09(0x23e)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x211b02=_0x49ef09,_0x1eca07=_0x5f0e0a[_0x211b02(0x22d)]['currentTrails'];_0x5f0e0a['framebuffers'][_0x211b02(0x219)]=_0x5f0e0a['framebuffers']['nextTrails'],_0x5f0e0a['framebuffers']['nextTrails']=_0x1eca07,_0x5f0e0a['primitives']['trails'][_0x211b02(0x1fa)]['framebuffer']=_0x5f0e0a['framebuffers']['nextTrails'],_0x5f0e0a[_0x211b02(0x1f0)]['trails']['clearCommand']['framebuffer']=_0x5f0e0a['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0x49ef09(0x274)],'uniformMap':{'trailsColorTexture':function(){const _0x58ff3e=_0x49ef09;return _0x5f0e0a['framebuffers'][_0x58ff3e(0x26d)][_0x58ff3e(0x249)](0x0);},'trailsDepthTexture':function(){return _0x5f0e0a['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4[(_0x49ef09(0x24f))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x49ef09(0x23e)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x294171(0x1b7),updateSpeed_frag=_0x294171(0x1c9),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag=_0x294171(0x1c2),postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x3751fa,_0x34119b,_0x1521a2,_0x469194){const _0x52ea35=_0x294171;this[_0x52ea35(0x1f6)]=_0x34119b,this['createWindTextures'](_0x3751fa,_0x34119b),this['createParticlesTextures'](_0x3751fa,_0x1521a2,_0x469194),this['createComputingPrimitives'](_0x34119b,_0x1521a2,_0x469194);}['createWindTextures'](_0x4ea45c,_0x54fb86){const _0x2babcd=_0x294171,_0x15eec0={'context':_0x4ea45c,'width':_0x54fb86['dimensions'][_0x2babcd(0x1bd)],'height':_0x54fb86[_0x2babcd(0x222)][_0x2babcd(0x250)]*(_0x54fb86[_0x2babcd(0x222)]['lev']||0x1),'pixelFormat':Cesium$3[_0x2babcd(0x25c)]['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x2babcd(0x261)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x2babcd(0x1db)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x15eec0,_0x54fb86['U']['array']),'V':Util[_0x2babcd(0x208)](_0x15eec0,_0x54fb86['V']['array'])};}[_0x294171(0x260)](_0x5a8a36,_0xae9bc,_0x2138d6){const _0x49011e=_0x294171,_0x8463a9={'context':_0x5a8a36,'width':_0xae9bc['particlesTextureSize'],'height':_0xae9bc['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x49011e(0x241))]({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x49011e(0x1db)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x31ca86=this['randomizeParticles'](_0xae9bc['maxParticles'],_0x2138d6),_0x41fc1e=new Float32Array(0x4*_0xae9bc['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x8463a9),'currentParticlesPosition':Util[_0x49011e(0x208)](_0x8463a9,_0x31ca86),'nextParticlesPosition':Util[_0x49011e(0x208)](_0x8463a9,_0x31ca86),'currentParticlesSpeed':Util[_0x49011e(0x208)](_0x8463a9,_0x41fc1e),'nextParticlesSpeed':Util[_0x49011e(0x208)](_0x8463a9,_0x41fc1e),'postProcessingPosition':Util['createTexture'](_0x8463a9,_0x31ca86),'postProcessingSpeed':Util['createTexture'](_0x8463a9,_0x41fc1e)};}['randomizeParticles'](_0x24f781,_0x1884df){const _0x330d92=_0x294171,_0x1fecc4=new Float32Array(0x4*_0x24f781);for(let _0x13c8cc=0x0;_0x13c8cc<_0x24f781;_0x13c8cc++){_0x1fecc4[0x4*_0x13c8cc]=Cesium$3['Math']['randomBetween'](_0x1884df['lonRange']['x'],_0x1884df['lonRange']['y']),_0x1fecc4[0x4*_0x13c8cc+0x1]=Cesium$3[_0x330d92(0x198)]['randomBetween'](_0x1884df['latRange']['x'],_0x1884df[_0x330d92(0x20c)]['y']),_0x1fecc4[0x4*_0x13c8cc+0x2]=Cesium$3['Math']['randomBetween'](this['data'][_0x330d92(0x1e1)][_0x330d92(0x1aa)],this['data'][_0x330d92(0x1e1)][_0x330d92(0x190)]),_0x1fecc4[0x4*_0x13c8cc+0x3]=0x0;}return _0x1fecc4;}['destroyParticlesTextures'](){const _0xe22605=_0x294171;Object[_0xe22605(0x214)](this['particlesTextures'])['forEach'](_0x546d1b=>{this['particlesTextures'][_0x546d1b]['destroy']();});}['createComputingPrimitives'](_0x47a912,_0x13029e,_0x130a0f){const _0x1a5734=_0x294171,_0x47f984=new Cesium$3['Cartesian3'](_0x47a912['dimensions'][_0x1a5734(0x1bd)],_0x47a912['dimensions']['lat'],_0x47a912['dimensions'][_0x1a5734(0x1e1)]),_0x20733e=new Cesium$3['Cartesian3'](_0x47a912['lon']['min'],_0x47a912['lat']['min'],_0x47a912[_0x1a5734(0x1e1)]['min']),_0x2872a2=new Cesium$3['Cartesian3'](_0x47a912['lon']['max'],_0x47a912['lat'][_0x1a5734(0x190)],_0x47a912['lev'][_0x1a5734(0x190)]),_0x5d4390=new Cesium$3['Cartesian3']((_0x2872a2['x']-_0x20733e['x'])/(_0x47f984['x']-0x1),(_0x2872a2['y']-_0x20733e['y'])/(_0x47f984['y']-0x1),_0x47f984['z']>0x1?(_0x2872a2['z']-_0x20733e['z'])/(_0x47f984['z']-0x1):0x1),_0x5d7035=new Cesium$3['Cartesian2'](_0x47a912['U']['min'],_0x47a912['U']['max']),_0x264a2a=new Cesium$3['Cartesian2'](_0x47a912['V']['min'],_0x47a912['V'][_0x1a5734(0x190)]),_0x3e8074=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0x1a5734(0x1c3),'uniformMap':{'U':function(){const _0x10a060=_0x1a5734;return _0x3e8074[_0x10a060(0x1fd)]['U'];},'V':function(){return _0x3e8074['windTextures']['V'];},'currentParticlesPosition':function(){const _0x3878b5=_0x1a5734;return _0x3e8074[_0x3878b5(0x209)][_0x3878b5(0x1e3)];},'dimension':function(){return _0x47f984;},'minimum':function(){return _0x20733e;},'maximum':function(){return _0x2872a2;},'interval':function(){return _0x5d4390;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this[_0x1a5734(0x209)]['particlesWind'],'preExecute':function(){const _0x27780f=_0x1a5734;_0x3e8074[_0x27780f(0x1f0)]['getWind']['commandToExecute'][_0x27780f(0x265)]=_0x3e8074[_0x27780f(0x209)]['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x1a5734(0x1c3),'uniformMap':{'currentParticlesSpeed':function(){return _0x3e8074['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){return _0x3e8074['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x5d7035;},'vSpeedRange':function(){return _0x264a2a;},'pixelSize':function(){return _0x130a0f['pixelSize'];},'speedFactor':function(){return _0x13029e['speedFactor'];}},'fragmentShaderSource':new Cesium$3[(_0x1a5734(0x24f))]({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x4822af=_0x1a5734,_0x3ffdad=_0x3e8074['particlesTextures'][_0x4822af(0x239)];_0x3e8074['particlesTextures']['currentParticlesSpeed']=_0x3e8074['particlesTextures'][_0x4822af(0x252)],_0x3e8074[_0x4822af(0x209)]['postProcessingSpeed']=_0x3ffdad,_0x3e8074[_0x4822af(0x1f0)]['updateSpeed'][_0x4822af(0x1fa)]['outputTexture']=_0x3e8074['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x3e8074['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x47a5db=_0x1a5734;return _0x3e8074[_0x47a5db(0x209)]['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures'][_0x1a5734(0x1d0)],'preExecute':function(){const _0xa06860=_0x1a5734,_0x2bae2c=_0x3e8074['particlesTextures'][_0xa06860(0x1e3)];_0x3e8074[_0xa06860(0x209)]['currentParticlesPosition']=_0x3e8074['particlesTextures'][_0xa06860(0x191)],_0x3e8074[_0xa06860(0x209)][_0xa06860(0x191)]=_0x2bae2c,_0x3e8074['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x3e8074['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0xa14c81=_0x1a5734;return _0x3e8074['particlesTextures'][_0xa14c81(0x1d0)];},'nextParticlesSpeed':function(){const _0x6221f=_0x1a5734;return _0x3e8074['particlesTextures'][_0x6221f(0x26e)];},'lonRange':function(){return _0x130a0f['lonRange'];},'latRange':function(){const _0x410960=_0x1a5734;return _0x130a0f[_0x410960(0x20c)];},'randomCoefficient':function(){const _0x14d945=Math['random']();return _0x14d945;},'dropRate':function(){return _0x13029e['dropRate'];},'dropRateBump':function(){const _0x4dea75=_0x1a5734;return _0x13029e[_0x4dea75(0x24d)];}},'fragmentShaderSource':new Cesium$3[(_0x1a5734(0x24f))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x1a5734(0x209)]['postProcessingPosition'],'preExecute':function(){const _0x39ed73=_0x1a5734;_0x3e8074['primitives'][_0x39ed73(0x191)]['commandToExecute']['outputTexture']=_0x3e8074['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){const _0x419a61=_0x1a5734;return _0x3e8074[_0x419a61(0x209)][_0x419a61(0x191)];},'nextParticlesSpeed':function(){return _0x3e8074['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x1a5734(0x252)],'preExecute':function(){const _0x58bc75=_0x1a5734;_0x3e8074['primitives'][_0x58bc75(0x252)]['commandToExecute']['outputTexture']=_0x3e8074['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x49ee81,_0x2b1bf8,_0x268955,_0x30f272){const _0x18b45a=_0x294171;this['context']=_0x49ee81,_0x2b1bf8={..._0x2b1bf8},_0x2b1bf8['udata']&&_0x2b1bf8['vdata']&&(_0x2b1bf8['dimensions']={},_0x2b1bf8['dimensions']['lon']=_0x2b1bf8[_0x18b45a(0x264)],_0x2b1bf8['dimensions']['lat']=_0x2b1bf8['rows'],_0x2b1bf8['dimensions']['lev']=_0x2b1bf8['lev']||0x1,_0x2b1bf8[_0x18b45a(0x1bd)]={},_0x2b1bf8[_0x18b45a(0x1bd)]['min']=_0x2b1bf8['xmin'],_0x2b1bf8[_0x18b45a(0x1bd)]['max']=_0x2b1bf8['xmax'],_0x2b1bf8[_0x18b45a(0x250)]={},_0x2b1bf8['lat']['min']=_0x2b1bf8[_0x18b45a(0x1fe)],_0x2b1bf8['lat']['max']=_0x2b1bf8[_0x18b45a(0x19e)],_0x2b1bf8['lev']={},_0x2b1bf8['lev']['min']=_0x2b1bf8['levmin']??0x1,_0x2b1bf8['lev']['max']=_0x2b1bf8['levmax']??0x1,_0x2b1bf8['U']={},_0x2b1bf8['U']['array']=new Float32Array(_0x2b1bf8['udata']),_0x2b1bf8['U'][_0x18b45a(0x1aa)]=_0x2b1bf8['umin']??Math[_0x18b45a(0x1aa)](..._0x2b1bf8[_0x18b45a(0x26c)]),_0x2b1bf8['U']['max']=_0x2b1bf8['umax']??Math['max'](..._0x2b1bf8['udata']),_0x2b1bf8['V']={},_0x2b1bf8['V']['array']=new Float32Array(_0x2b1bf8['vdata']),_0x2b1bf8['V'][_0x18b45a(0x1aa)]=_0x2b1bf8['vmin']??Math[_0x18b45a(0x1aa)](..._0x2b1bf8['vdata']),_0x2b1bf8['V']['max']=_0x2b1bf8['vmax']??Math[_0x18b45a(0x190)](..._0x2b1bf8[_0x18b45a(0x1cb)])),this['data']=_0x2b1bf8,this['options']=_0x268955,this['viewerParameters']=_0x30f272,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x18b45a(0x1f6)],this[_0x18b45a(0x254)],this['viewerParameters'],this[_0x18b45a(0x242)]);}[_0x294171(0x1f4)](_0x214e74){const _0x395a32=_0x294171;this['particlesComputing']['destroyParticlesTextures'](),Object[_0x395a32(0x214)](this['particlesComputing']['windTextures'])[_0x395a32(0x1ef)](_0x2fa8a2=>{const _0x21e3d5=_0x395a32;this['particlesComputing']['windTextures'][_0x2fa8a2][_0x21e3d5(0x1d2)]();}),this[_0x395a32(0x1ca)][_0x395a32(0x20f)][_0x395a32(0x1ac)]['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x588a57=>{const _0x327095=_0x395a32;this[_0x327095(0x1ca)]['framebuffers'][_0x588a57]['destroy']();}),this['context']=_0x214e74,this['particlesComputing']=new ParticlesComputing(this[_0x395a32(0x194)],this['data'],this[_0x395a32(0x254)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x395a32(0x1f6)],this['options'],this['viewerParameters'],this[_0x395a32(0x242)]);}[_0x294171(0x218)](){const _0x569e4f=_0x294171,_0x25e1ff=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this['particlesRendering'][_0x569e4f(0x22d)])['forEach'](_0x117b64=>{const _0x550cd1=_0x569e4f;_0x25e1ff['framebuffer']=this['particlesRendering']['framebuffers'][_0x117b64],_0x25e1ff[_0x550cd1(0x245)](this[_0x550cd1(0x194)]);});}['refreshParticles'](_0x575040){const _0x2e9d76=_0x294171;this[_0x2e9d76(0x218)](),this[_0x2e9d76(0x242)]['destroyParticlesTextures'](),this[_0x2e9d76(0x242)][_0x2e9d76(0x260)](this['context'],this['options'],this['viewerParameters']);if(_0x575040){const _0x2f915f=this['particlesRendering'][_0x2e9d76(0x1a2)](this['options']);this['particlesRendering'][_0x2e9d76(0x1f0)]['segments'][_0x2e9d76(0x1fc)]=_0x2f915f;const _0x5ab53f=Cesium$2[_0x2e9d76(0x20e)]['fromGeometry']({'context':this['context'],'geometry':_0x2f915f,'attributeLocations':this['particlesRendering']['primitives']['segments']['attributeLocations'],'bufferUsage':Cesium$2[_0x2e9d76(0x1a4)][_0x2e9d76(0x221)]});this[_0x2e9d76(0x1ca)][_0x2e9d76(0x1f0)]['segments']['commandToExecute']['vertexArray']=_0x5ab53f;}}['setOptions'](_0x1ad74b){const _0x41a899=_0x294171;let _0x2092f8=![];this['options']['maxParticles']!==_0x1ad74b[_0x41a899(0x21d)]&&(_0x2092f8=!![]),Object[_0x41a899(0x214)](_0x1ad74b)[_0x41a899(0x1ef)](_0x3ca7e7=>{this['options'][_0x3ca7e7]=_0x1ad74b[_0x3ca7e7];}),this['refreshParticles'](_0x2092f8);}['applyViewerParameters'](_0x2931b6){const _0x4a1ae5=_0x294171;Object[_0x4a1ae5(0x214)](_0x2931b6)['forEach'](_0xc2ebeb=>{this['viewerParameters'][_0xc2ebeb]=_0x2931b6[_0xc2ebeb];}),this['refreshParticles'](![]);}['destroy'](){const _0x162925=_0x294171;clearTimeout(this['canrefresh']),this['particlesComputing'][_0x162925(0x21c)](),Object['keys'](this[_0x162925(0x242)]['windTextures'])[_0x162925(0x1ef)](_0x19ab5f=>{const _0x3c37b8=_0x162925;this['particlesComputing'][_0x3c37b8(0x1fd)][_0x19ab5f][_0x3c37b8(0x1d2)]();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x20a116=>{const _0x456887=_0x162925;this['particlesRendering'][_0x456887(0x22d)][_0x20a116]['destroy']();});for(const _0x3bb267 in this){delete this[_0x3bb267];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x294171(0x1a8)]};class WindLayer extends BaseLayer$1{constructor(_0x4e555a={}){const _0x2f05ea=_0x294171;_0x4e555a={...DEF_OPTIONS,..._0x4e555a},super(_0x4e555a),this[_0x2f05ea(0x1c6)](_0x4e555a);}get[_0x294171(0x21a)](){return this['primitives'];}get['data'](){return this['_data'];}set['data'](_0x4d2afe){this['setData'](_0x4d2afe);}get['colors'](){return this['options']['colors'];}set['colors'](_0xa7165){const _0x387937=_0x294171;this['options'][_0x387937(0x1f2)]=_0xa7165,this['particleSystem']&&this[_0x387937(0x275)]['setOptions']({'colors':_0xa7165}),this['resize']();}[_0x294171(0x1dd)](){}['_addedHook'](){const _0x534480=_0x294171;this['scene']=this[_0x534480(0x272)][_0x534480(0x279)],this[_0x534480(0x263)]=this['_map']['camera'],this['primitives']=new Cesium$1[(_0x534480(0x227))](),this[_0x534480(0x272)]['scene']['primitives']['add'](this[_0x534480(0x1f0)]),this[_0x534480(0x1eb)]={'lonRange':new Cesium$1[(_0x534480(0x232))](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x534480(0x257)]=new Cesium$1[(_0x534480(0x21f))](Cesium$1['Cartesian3'][_0x534480(0x197)],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this[_0x534480(0x235)]['bind'](this),![]),this[_0x534480(0x22e)]=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x534480(0x22f)][_0x534480(0x1b0)],this['_onMouseDownEvent'],this),this[_0x534480(0x272)]['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x534480(0x1e4)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x534480(0x25d)]&&this['setData'](this[_0x534480(0x25d)]);}['_removedHook'](){const _0xd6f60e=_0x294171;window['removeEventListener'](_0xd6f60e(0x235),this['resize']),this['_map']['off'](mars3d__namespace['EventType'][_0xd6f60e(0x22c)],this['_onMap_preRenderEvent'],this),this['_map'][_0xd6f60e(0x1ea)](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0xd6f60e(0x272)]['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0xd6f60e(0x272)][_0xd6f60e(0x1ea)](mars3d__namespace['EventType']['mouseUp'],this[_0xd6f60e(0x1e4)],this),this[_0xd6f60e(0x272)][_0xd6f60e(0x1ea)](mars3d__namespace['EventType']['mouseMove'],this[_0xd6f60e(0x238)],this),this[_0xd6f60e(0x1f0)][_0xd6f60e(0x1ad)](),this['_map'][_0xd6f60e(0x279)]['primitives']['remove'](this[_0xd6f60e(0x1f0)]);}['resize'](){const _0x4eccb8=_0x294171;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives'][_0x4eccb8(0x1ad)](),this['_map']['once'](mars3d__namespace['EventType'][_0x4eccb8(0x22c)],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x31782a){const _0xb0d1fd=_0x294171;this['particleSystem'][_0xb0d1fd(0x1f4)](this['scene']['context']),this['addPrimitives'](),this[_0xb0d1fd(0x1f0)][_0xb0d1fd(0x1b5)]=!![];}[_0x294171(0x195)](_0x3c17d9){const _0x5a2ee9=_0x294171;clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this[_0x5a2ee9(0x1f0)]['show']=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}[_0x294171(0x27b)](_0x5acc7e){const _0x2c1bb4=_0x294171;this[_0x2c1bb4(0x22e)]=!![];}['_onMouseMoveEvent'](_0x2f3920){const _0x2b17c8=_0x294171;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this['primitives'][_0x2b17c8(0x1b5)]=![],this[_0x2b17c8(0x220)]=!![]);}[_0x294171(0x1e4)](_0xd43f66){const _0x311400=_0x294171;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this[_0x311400(0x196)](),this['primitives']['show']=!![],this[_0x311400(0x22e)]=![],this['mouse_move']=![];}['redraw'](){const _0x1fd161=_0x294171;if(!this[_0x1fd161(0x272)]||!this[_0x1fd161(0x1b5)])return;this['updateViewerParameters'](),this[_0x1fd161(0x275)][_0x1fd161(0x1b2)](this[_0x1fd161(0x1eb)]),this[_0x1fd161(0x1f0)]['show']=!![];}['setData'](_0x1e3200){const _0x8d6e2b=_0x294171;this[_0x8d6e2b(0x25d)]=_0x1e3200,this['particleSystem']&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this['scene'][_0x8d6e2b(0x194)],_0x1e3200,this[_0x8d6e2b(0x240)](),this['viewerParameters']),this['addPrimitives']();}[_0x294171(0x1c6)](_0x3dc189,_0x3e6be2){const _0x4dacdb=_0x294171;if(_0x3dc189)for(const _0x4cfb08 in _0x3dc189){this[_0x4cfb08]=_0x3dc189[_0x4cfb08];}this['particleSystem']&&this['particleSystem']['setOptions'](this[_0x4dacdb(0x240)]());}['getOptions'](){const _0x53c30d=_0x294171,_0x201533=Math['ceil'](Math[_0x53c30d(0x24c)](this['particlesNumber']));return this['particlesNumber']=_0x201533*_0x201533,{'particlesTextureSize':_0x201533,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x53c30d(0x256)],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x57d8c=_0x294171;this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x57d8c(0x1f0)]['getWind']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['updateSpeed']),this['primitives'][_0x57d8c(0x1df)](this['particleSystem']['particlesComputing']['primitives']['updatePosition']),this['primitives']['add'](this['particleSystem'][_0x57d8c(0x242)]['primitives']['postProcessingPosition']),this['primitives']['add'](this[_0x57d8c(0x275)]['particlesComputing']['primitives']['postProcessingSpeed']),this['primitives']['add'](this['particleSystem']['particlesRendering'][_0x57d8c(0x1f0)]['segments']),this['primitives'][_0x57d8c(0x1df)](this['particleSystem']['particlesRendering'][_0x57d8c(0x1f0)]['trails']),this['primitives']['add'](this[_0x57d8c(0x275)]['particlesRendering']['primitives']['screen']);}['updateViewerParameters'](){const _0x47482c=_0x294171;let _0x2e27d8=this[_0x47482c(0x263)]['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0x2e27d8){const _0x4849ba=this['_map']['getExtent']();_0x2e27d8=Cesium$1['Rectangle']['fromDegrees'](_0x4849ba['xmin'],_0x4849ba['ymin'],_0x4849ba['xmax'],_0x4849ba['ymax']);}const _0x3c1ab9=Util['viewRectangleToLonLatRange'](_0x2e27d8);this['viewerParameters']['lonRange']['x']=_0x3c1ab9[_0x47482c(0x1bd)]['min'],this['viewerParameters']['lonRange']['y']=_0x3c1ab9['lon']['max'],this[_0x47482c(0x1eb)][_0x47482c(0x20c)]['x']=_0x3c1ab9['lat']['min'],this['viewerParameters']['latRange']['y']=_0x3c1ab9[_0x47482c(0x250)]['max'];const _0x36485a=this[_0x47482c(0x263)][_0x47482c(0x1e6)](this['globeBoundingSphere'],this[_0x47482c(0x279)]['drawingBufferWidth'],this['scene'][_0x47482c(0x262)]);_0x36485a>0x0&&(this[_0x47482c(0x1eb)][_0x47482c(0x27d)]=_0x36485a);}}mars3d__namespace['LayerUtil'][_0x294171(0x1ae)]('wind',WindLayer),mars3d__namespace['layer'][_0x294171(0x217)]=WindLayer;class CanvasParticle{constructor(){this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this['age']=null;}['destroy'](){for(const _0x5933f3 in this){delete this[_0x5933f3];}}}class CanvasWindField{constructor(_0x409128){this['setOptions'](_0x409128);}get['speedRate'](){const _0x1989d9=_0x294171;return this[_0x1989d9(0x1d3)];}set['speedRate'](_0x3dca61){const _0xdad4de=_0x294171;this['_speedRate']=(0x64-(_0x3dca61>0x63?0x63:_0x3dca61))*0x64,this[_0xdad4de(0x1cf)]=[(this['xmax']-this[_0xdad4de(0x19f)])/this[_0xdad4de(0x1d3)],(this['ymax']-this[_0xdad4de(0x1fe)])/this['_speedRate']];}get['maxAge'](){const _0x3450b1=_0x294171;return this[_0x3450b1(0x1e8)];}set['maxAge'](_0x498905){const _0x4ef2a3=_0x294171;this[_0x4ef2a3(0x1e8)]=_0x498905;}['setOptions'](_0x23f008){const _0x4b9aa2=_0x294171;this['options']=_0x23f008,this['maxAge']=_0x23f008['maxAge']||0x78,this['speedRate']=_0x23f008[_0x4b9aa2(0x206)]||0x32,this['particles']=[];const _0x1dd9c5=_0x23f008['particlesNumber']||0x1000;for(let _0x4344a6=0x0;_0x4344a6<_0x1dd9c5;_0x4344a6++){const _0x479bb9=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x479bb9);}}['setDate'](_0x4b73eb){const _0x465b71=_0x294171;this[_0x465b71(0x1a7)]=_0x4b73eb['rows'],this['cols']=_0x4b73eb['cols'],this['xmin']=_0x4b73eb[_0x465b71(0x19f)],this['xmax']=_0x4b73eb['xmax'],this['ymin']=_0x4b73eb[_0x465b71(0x1fe)],this['ymax']=_0x4b73eb[_0x465b71(0x19e)],this[_0x465b71(0x278)]=[];const _0x13452f=_0x4b73eb['udata'],_0x47bef4=_0x4b73eb['vdata'];let _0x1b7e52=![];_0x13452f['length']===this['rows']&&_0x13452f[0x0]['length']===this['cols']&&(_0x1b7e52=!![]);let _0x2f45c9=0x0,_0x2607c9=null,_0x436eb4=null;for(let _0x2f99d1=0x0;_0x2f99d1<this['rows'];_0x2f99d1++){_0x2607c9=[];for(let _0x2cc96a=0x0;_0x2cc96a<this['cols'];_0x2cc96a++,_0x2f45c9++){_0x1b7e52?_0x436eb4=this[_0x465b71(0x1d5)](_0x13452f[_0x2f99d1][_0x2cc96a],_0x47bef4[_0x2f99d1][_0x2cc96a]):_0x436eb4=this['_calcUV'](_0x13452f[_0x2f45c9],_0x47bef4[_0x2f45c9]),_0x2607c9[_0x465b71(0x1a0)](_0x436eb4);}this['grid']['push'](_0x2607c9);}this['options']['reverseY']&&this['grid']['reverse']();}['clear'](){const _0x5a5fa0=_0x294171;delete this['rows'],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this['ymax'],delete this[_0x5a5fa0(0x278)],delete this['particles'];}['toGridXY'](_0x49b025,_0x19cb8c){const _0x13b762=_0x294171,_0x26b76c=(_0x49b025-this[_0x13b762(0x19f)])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x388c46=(this['ymax']-_0x19cb8c)/(this['ymax']-this['ymin'])*(this[_0x13b762(0x1a7)]-0x1);return[_0x26b76c,_0x388c46];}[_0x294171(0x204)](_0x465dca,_0x4425ff){const _0x280054=_0x294171;if(_0x465dca<0x0||_0x465dca>=this['cols']||_0x4425ff>=this['rows'])return[0x0,0x0,0x0];const _0xf14566=Math['floor'](_0x465dca),_0x4ef329=Math[_0x280054(0x1e5)](_0x4425ff);if(_0xf14566===_0x465dca&&_0x4ef329===_0x4425ff)return this['grid'][_0x4425ff][_0x465dca];const _0x1cc7a4=_0xf14566+0x1,_0x932fd2=_0x4ef329+0x1,_0x1a9e4d=this['getUVByXY'](_0xf14566,_0x4ef329),_0x10b16f=this['getUVByXY'](_0x1cc7a4,_0x4ef329),_0x543f08=this['getUVByXY'](_0xf14566,_0x932fd2),_0x2b520f=this[_0x280054(0x204)](_0x1cc7a4,_0x932fd2);let _0x373c14=null;try{_0x373c14=this['_bilinearInterpolation'](_0x465dca-_0xf14566,_0x4425ff-_0x4ef329,_0x1a9e4d,_0x10b16f,_0x543f08,_0x2b520f);}catch(_0x2636ba){console['log'](_0x465dca,_0x4425ff);}return _0x373c14;}['_bilinearInterpolation'](_0x5ddcf6,_0x45a46d,_0x33edb8,_0x5549f6,_0x278bc2,_0x1adaec){const _0x12f7ad=0x1-_0x5ddcf6,_0x1394a0=0x1-_0x45a46d,_0xc349e3=_0x12f7ad*_0x1394a0,_0x11c891=_0x5ddcf6*_0x1394a0,_0x1cefe7=_0x12f7ad*_0x45a46d,_0x37a34f=_0x5ddcf6*_0x45a46d,_0x2e5fa7=_0x33edb8[0x0]*_0xc349e3+_0x5549f6[0x0]*_0x11c891+_0x278bc2[0x0]*_0x1cefe7+_0x1adaec[0x0]*_0x37a34f,_0x2793ab=_0x33edb8[0x1]*_0xc349e3+_0x5549f6[0x1]*_0x11c891+_0x278bc2[0x1]*_0x1cefe7+_0x1adaec[0x1]*_0x37a34f;return this['_calcUV'](_0x2e5fa7,_0x2793ab);}['_calcUV'](_0x36f768,_0x5ccf80){return[+_0x36f768,+_0x5ccf80,Math['sqrt'](_0x36f768*_0x36f768+_0x5ccf80*_0x5ccf80)];}['getUVByPoint'](_0x1112e8,_0x4f5f39){const _0x3f3f4b=_0x294171;if(!this['isInExtent'](_0x1112e8,_0x4f5f39))return null;const _0x1ae8f5=this[_0x3f3f4b(0x19a)](_0x1112e8,_0x4f5f39),_0x352f27=this[_0x3f3f4b(0x204)](_0x1ae8f5[0x0],_0x1ae8f5[0x1]);return _0x352f27;}['isInExtent'](_0x4b5622,_0x8e0846){return _0x4b5622>=this['xmin']&&_0x4b5622<=this['xmax']&&_0x8e0846>=this['ymin']&&_0x8e0846<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x486b4d=_0x294171,_0x3e8d82=fRandomByfloat(this['xmin'],this[_0x486b4d(0x26b)]),_0x1dbdf4=fRandomByfloat(this['ymin'],this[_0x486b4d(0x19e)]);return{'lat':_0x1dbdf4,'lng':_0x3e8d82};}[_0x294171(0x230)](){const _0x284fb9=_0x294171;let _0x5bf94f,_0x476f09,_0x49a767;for(let _0x280970=0x0,_0x1585c7=this['particles']['length'];_0x280970<_0x1585c7;_0x280970++){let _0x5a8423=this['particles'][_0x280970];_0x5a8423['age']<=0x0&&(_0x5a8423=this[_0x284fb9(0x267)](_0x5a8423));if(_0x5a8423['age']>0x0){const _0x334a8c=_0x5a8423['tlng'],_0x8bd176=_0x5a8423[_0x284fb9(0x18e)];_0x49a767=this['getUVByPoint'](_0x334a8c,_0x8bd176),_0x49a767?(_0x5bf94f=_0x334a8c+this[_0x284fb9(0x1cf)][0x0]*_0x49a767[0x0],_0x476f09=_0x8bd176+this[_0x284fb9(0x1cf)][0x1]*_0x49a767[0x1],_0x5a8423['lng']=_0x334a8c,_0x5a8423[_0x284fb9(0x250)]=_0x8bd176,_0x5a8423[_0x284fb9(0x1da)]=_0x5bf94f,_0x5a8423[_0x284fb9(0x18e)]=_0x476f09,_0x5a8423[_0x284fb9(0x24e)]--):_0x5a8423[_0x284fb9(0x24e)]=0x0;}}return this['particles'];}[_0x294171(0x267)](_0x50fec5){const _0x11b164=_0x294171;let _0x118429,_0x3dd205;for(let _0x43c5de=0x0;_0x43c5de<0x1e;_0x43c5de++){_0x118429=this['getRandomLatLng'](),_0x3dd205=this['getUVByPoint'](_0x118429['lng'],_0x118429['lat']);if(_0x3dd205&&_0x3dd205[0x2]>0x0)break;}if(!_0x3dd205)return _0x50fec5;const _0x4f782e=_0x118429[_0x11b164(0x1bc)]+this['_calc_speedRate'][0x0]*_0x3dd205[0x0],_0x4cbea5=_0x118429['lat']+this[_0x11b164(0x1cf)][0x1]*_0x3dd205[0x1];return _0x50fec5['lng']=_0x118429['lng'],_0x50fec5[_0x11b164(0x250)]=_0x118429['lat'],_0x50fec5['tlng']=_0x4f782e,_0x50fec5['tlat']=_0x4cbea5,_0x50fec5['age']=Math['round'](Math['random']()*this['maxAge']),_0x50fec5;}['destroy'](){for(const _0x4892c2 in this){delete this[_0x4892c2];}}}function fRandomByfloat(_0xbb39a5,_0x2c3f45){return _0xbb39a5+Math['random']()*(_0x2c3f45-_0xbb39a5);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer'][_0x294171(0x211)];class CanvasWindLayer extends BaseLayer{constructor(_0x105d66={}){const _0x2ca334=_0x294171;super(_0x105d66),this[_0x2ca334(0x1c6)](_0x105d66),this[_0x2ca334(0x234)]=null;}['_setOptionsHook'](_0x562f9d,_0x4eb8a4){const _0x1a8e93=_0x294171;this[_0x1a8e93(0x1f7)]=0x3e8/(_0x562f9d['frameRate']||0xa),this['_pointerEvents']=this['options'][_0x1a8e93(0x1e0)]??![],this[_0x1a8e93(0x18d)]=_0x562f9d['color']||'#ffffff',this['lineWidth']=_0x562f9d[_0x1a8e93(0x1c8)]||0x1,this['fixedHeight']=_0x562f9d['fixedHeight']??0x0,this['reverseY']=_0x562f9d['reverseY']??![],this['windField']&&this['windField']['setOptions'](_0x562f9d);}get[_0x294171(0x21a)](){const _0x980873=_0x294171;return this[_0x980873(0x234)];}get['canvasWidth'](){return this['_map']['scene']['canvas']['clientWidth'];}get['canvasHeight'](){const _0x346f1c=_0x294171;return this['_map']['scene'][_0x346f1c(0x234)]['clientHeight'];}get['pointerEvents'](){const _0x5dae75=_0x294171;return this[_0x5dae75(0x237)];}set['pointerEvents'](_0x5a1424){const _0x55badc=_0x294171;this['_pointerEvents']=_0x5a1424;if(!this['canvas'])return;_0x5a1424?this[_0x55badc(0x234)]['style']['pointer-events']=_0x55badc(0x1af):this[_0x55badc(0x234)]['style']['pointer-events']=_0x55badc(0x1ba);}get[_0x294171(0x1bb)](){const _0x2e2313=_0x294171;return this['options'][_0x2e2313(0x1bb)];}set['particlesNumber'](_0x40c21d){this['options']['particlesNumber']=_0x40c21d,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){const _0x368121=_0x294171;return this['options'][_0x368121(0x206)];}set['speedRate'](_0x43e712){const _0x4f05ff=_0x294171;this['options'][_0x4f05ff(0x206)]=_0x43e712,this['windField']&&(this['windField']['speedRate']=_0x43e712);}get['maxAge'](){return this['options']['maxAge'];}set['maxAge'](_0x5c890c){const _0x749b29=_0x294171;this['options']['maxAge']=_0x5c890c,this[_0x749b29(0x1ab)]&&(this[_0x749b29(0x1ab)]['maxAge']=_0x5c890c);}get['data'](){return this['windData'];}set['data'](_0x155134){const _0x103369=_0x294171;this[_0x103369(0x251)](_0x155134);}[_0x294171(0x19c)](_0xa94562){const _0x10f219=_0x294171;_0xa94562?this[_0x10f219(0x1a3)]():(this[_0x10f219(0x236)]&&(this['options']['data']=this['windData']),this['_removedHook']());}[_0x294171(0x1dd)](){const _0xece369=_0x294171;this['options'][_0xece369(0x259)]?this[_0xece369(0x25a)]():this[_0xece369(0x1ab)]=new CanvasWindField(this['options']);}['_addedHook'](){const _0xffae23=_0x294171;this['canvas']=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this[_0xffae23(0x1ce)](),this[_0xffae23(0x254)][_0xffae23(0x1f6)]&&this['setData'](this['options'][_0xffae23(0x1f6)]);}['_removedHook'](){const _0x30c9e5=_0x294171;this['clear'](),this[_0x30c9e5(0x23a)](),this['canvas']&&(this['_map']['container'][_0x30c9e5(0x23f)](this['canvas']),delete this[_0x30c9e5(0x234)]);}[_0x294171(0x253)](){const _0x3975e1=_0x294171,_0x65a24a=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this[_0x3975e1(0x272)][_0x3975e1(0x200)]);return _0x65a24a['style']['position']='absolute',_0x65a24a['style']['top']=_0x3975e1(0x215),_0x65a24a['style'][_0x3975e1(0x18f)]='0px',_0x65a24a['style']['width']=this['_map']['scene']['canvas']['clientWidth']+'px',_0x65a24a['style']['height']=this[_0x3975e1(0x272)]['scene'][_0x3975e1(0x234)][_0x3975e1(0x1d9)]+'px',_0x65a24a[_0x3975e1(0x1e7)]['pointerEvents']=this[_0x3975e1(0x237)]?'auto':'none',_0x65a24a['style'][_0x3975e1(0x1d4)]=this['options']['zIndex']??0x9,_0x65a24a['width']=this['_map']['scene'][_0x3975e1(0x234)][_0x3975e1(0x1bf)],_0x65a24a[_0x3975e1(0x1fb)]=this['_map']['scene']['canvas']['clientHeight'],_0x65a24a;}['resize'](){const _0x10a09d=_0x294171;this[_0x10a09d(0x234)]&&(this['canvas'][_0x10a09d(0x1e7)][_0x10a09d(0x26a)]=this['_map']['scene']['canvas']['clientWidth']+'px',this[_0x10a09d(0x234)]['style']['height']=this['_map']['scene'][_0x10a09d(0x234)]['clientHeight']+'px',this['canvas']['width']=this[_0x10a09d(0x272)]['scene']['canvas']['clientWidth'],this['canvas']['height']=this['_map'][_0x10a09d(0x279)]['canvas']['clientHeight']);}['bindEvent'](){const _0x6038f9=_0x294171,_0xb5fcc0=this;let _0x1fd452=Date[_0x6038f9(0x1b3)]();(function _0x2d55c4(){const _0x249feb=_0x6038f9;_0xb5fcc0[_0x249feb(0x1de)]=window['requestAnimationFrame'](_0x2d55c4);if(_0xb5fcc0['show']&&_0xb5fcc0['windField']){const _0x59b5ec=Date['now'](),_0x1da5ce=_0x59b5ec-_0x1fd452;_0x1da5ce>_0xb5fcc0['frameTime']&&(_0x1fd452=_0x59b5ec-_0x1da5ce%_0xb5fcc0['frameTime'],_0xb5fcc0[_0x249feb(0x248)]());}}(),window['addEventListener'](_0x6038f9(0x235),this['resize']['bind'](this),![]),this[_0x6038f9(0x22e)]=![],this['mouse_move']=![],this[_0x6038f9(0x254)]['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x6038f9(0x272)]['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x2fe605=_0x294171;window['cancelAnimationFrame'](this['animateFrame']),delete this[_0x2fe605(0x1de)],window['removeEventListener']('resize',this['resize']),this['options'][_0x2fe605(0x223)]&&(this['_map']['off'](mars3d__namespace['EventType'][_0x2fe605(0x1f8)],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x2fe605(0x1b0)],this[_0x2fe605(0x27b)],this),this[_0x2fe605(0x272)]['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x2fe605(0x1b8)],this[_0x2fe605(0x238)],this));}['_onMapWhellEvent'](_0x5bc760){const _0x412b80=_0x294171;clearTimeout(this['refreshTimer']);if(!this[_0x412b80(0x1b5)]||!this['canvas'])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x40e213=_0x412b80;if(!this['show'])return;this[_0x40e213(0x196)](),this['canvas']['style']['visibility']=_0x40e213(0x22a);},0xc8);}[_0x294171(0x27b)](_0x29490d){const _0x5c7890=_0x294171;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace[_0x5c7890(0x22f)][_0x5c7890(0x1b8)],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}[_0x294171(0x238)](_0x5c9f13){const _0x56c881=_0x294171;if(!this['show']||!this['canvas'])return;this['mouse_down']&&(this[_0x56c881(0x234)]['style'][_0x56c881(0x1e2)]='hidden',this[_0x56c881(0x220)]=!![]);}['_onMouseUpEvent'](_0x39dc84){const _0x4b078c=_0x294171;if(!this['show']||!this['canvas'])return;this['_map'][_0x4b078c(0x1ea)](mars3d__namespace['EventType']['mouseMove'],this[_0x4b078c(0x238)],this),this[_0x4b078c(0x22e)]&&this[_0x4b078c(0x220)]&&this['redraw'](),this['canvas']['style'][_0x4b078c(0x1e2)]='visible',this['mouse_down']=![],this['mouse_move']=![];}['setData'](_0x157c7b){const _0x5abad0=_0x294171;this['clear'](),this['windData']=_0x157c7b,this['windField']['setDate'](_0x157c7b),this[_0x5abad0(0x196)]();}['redraw'](){const _0x5d732d=_0x294171;if(!this[_0x5d732d(0x1b5)])return;this['windField']['setOptions'](this['options']),this['update']();}['update'](){const _0x232093=_0x294171;if(this['_updateIng'])return;this[_0x232093(0x1f1)]=!![];if(this[_0x232093(0x259)])this['windField'][_0x232093(0x248)]();else{const _0x58a331=this['windField'][_0x232093(0x230)]();this[_0x232093(0x24a)](_0x58a331);}this['_updateIng']=![];}[_0x294171(0x24a)](_0x3cfd93){const _0x561a49=_0x294171;this['canvasContext']['globalCompositeOperation']=_0x561a49(0x243),this[_0x561a49(0x27c)]['fillRect'](0x0,0x0,this['canvasWidth'],this[_0x561a49(0x231)]),this['canvasContext']['globalCompositeOperation']=_0x561a49(0x269),this['canvasContext']['globalAlpha']=0.9,this[_0x561a49(0x27c)][_0x561a49(0x1f5)](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x561a49(0x27c)]['strokeStyle']=this['color'];const _0x1a4cba=this[_0x561a49(0x272)]['scene'][_0x561a49(0x20d)]!==Cesium['SceneMode'][_0x561a49(0x268)],_0x57baf3=this[_0x561a49(0x1c7)]*0.25;for(let _0x38a714=0x0,_0x131ee5=_0x3cfd93['length'];_0x38a714<_0x131ee5;_0x38a714++){const _0x5c3d20=_0x3cfd93[_0x38a714],_0x91c74=this['_tomap'](_0x5c3d20['lng'],_0x5c3d20[_0x561a49(0x250)],_0x5c3d20),_0x11b75a=this[_0x561a49(0x1c5)](_0x5c3d20['tlng'],_0x5c3d20['tlat'],_0x5c3d20);if(!_0x91c74||!_0x11b75a)continue;if(_0x1a4cba&&Math[_0x561a49(0x23c)](_0x91c74[0x0]-_0x11b75a[0x0])>=_0x57baf3)continue;this['canvasContext'][_0x561a49(0x1a1)](_0x91c74[0x0],_0x91c74[0x1]),this[_0x561a49(0x27c)]['lineTo'](_0x11b75a[0x0],_0x11b75a[0x1]);}this['canvasContext'][_0x561a49(0x1d1)]();}['_tomap'](_0x57be03,_0x242498,_0x2ababb){const _0x570464=_0x294171,_0x1486c0=Cesium[_0x570464(0x213)]['fromDegrees'](_0x57be03,_0x242498,this[_0x570464(0x1be)]),_0x420239=this['_map']['scene'];if(_0x420239['mode']===Cesium['SceneMode']['SCENE3D']){const _0x52f03e=new Cesium['EllipsoidalOccluder'](_0x420239['globe']['ellipsoid'],_0x420239[_0x570464(0x263)][_0x570464(0x1a6)]),_0x3262ea=_0x52f03e['isPointVisible'](_0x1486c0);if(!_0x3262ea)return _0x2ababb['age']=0x0,null;}const _0x1a4cdd=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x1486c0);return _0x1a4cdd?[_0x1a4cdd['x'],_0x1a4cdd['y']]:null;}['clear'](){const _0x44febc=_0x294171;this['windField'][_0x44febc(0x1e9)](),delete this['windData'];}['initWorker'](){const _0x540811=_0x294171;this[_0x540811(0x259)]=new Worker(this['options'][_0x540811(0x259)]),this['worker']['onmessage']=_0x31cc39=>{const _0x371dff=_0x540811;this['_drawLines'](_0x31cc39[_0x371dff(0x1f6)]['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x9e9bfb=>{const _0x585b4=_0x540811;this[_0x585b4(0x259)]['postMessage']({'type':'init','options':_0x9e9bfb});},'setOptions':_0x475a82=>{this['worker']['postMessage']({'type':'setOptions','options':_0x475a82});},'setDate':_0x252420=>{const _0x36b57c=_0x540811;this['worker']['postMessage']({'type':_0x36b57c(0x1cd),'data':_0x252420});},'update':()=>{const _0x21bc23=_0x540811;if(this['_updateIng2'])return;this[_0x21bc23(0x1ec)]=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this['windField']['init'](this[_0x540811(0x254)]);}}mars3d__namespace['LayerUtil']['register'](_0x294171(0x1cc),CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports[_0x294171(0x1dc)]=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports[_0x294171(0x1b9)]=WindUtil,Object[_0x294171(0x193)](exports,'__esModule',{'value':!![]});
}));
